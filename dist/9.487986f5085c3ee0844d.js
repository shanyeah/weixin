webpackJsonp([9],{483:function(e,t,a){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(185),s=n(o),r=a(9),l=n(r),c=a(5),d=n(c),u=a(8),m=n(u),h=a(6),f=n(h),v=a(7),p=n(v);a(186);var g=a(0),_=n(g),y=a(183),N=(i(y),a(568)),E=n(N),S=a(190),k=i(S),b=a(187),I=n(b),T=a(184);a(570);var M=function(e){function t(e){(0,d.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return a.state={organId:0,stgId:0,organName:"",movieList:[],nextPage:1,hasNextPage:!1,searchValue:"",condition:null,area:-1,moviecatId:-1,times:-1},a}return(0,p.default)(t,e),(0,m.default)(t,[{key:"componentDidMount",value:function(e){var t=I.default.parse(this.props.location.search);this.state.organId=t.organId,this.state.stgId=t.stgId,this.state.organName=t.organName,document.title="电影",this.reload()}},{key:"reload",value:function(){this.state.nextPage=1,this.loadData(),this.loadCondition()}},{key:"loadData",value:function(e){var t=this,a=this.state.nextPage,i={stgIdText:this.state.stgId,pageNum:a};-1!=this.state.area&&(i.area=this.state.area),-1!=this.state.moviecatId&&(i.moviecatId=this.state.moviecatId),-1!=this.state.times&&(i.times=this.state.times),this.state.searchValue.length>0&&(i.keyword=this.state.searchValue),1==a&&s.default.loading("加载中...",30),k.queryMovieList(i,{success:function(i){s.default.hide();var n=i.dataList,o=[];o=1==a?n:Array.prototype.concat.apply(t.state.movieList,n),e&&e(),t.setState({movieList:o,hasNextPage:i.hasNextPage,nextPage:i.pageNum+1})},error:function(t){s.default.hide(),s.default.fail(t),e&&e()}})}},{key:"loadMore",value:function(e){this.loadData(e)}},{key:"loadCondition",value:function(){var e=this,t={stgIdText:this.state.stgId};-1!=this.state.area&&(t.area=this.state.area),-1!=this.state.moviecatId&&(t.moviecatId=this.state.moviecatId),-1!=this.state.times&&(t.times=this.state.times),k.movieQueryCondition(t,{success:function(t){e.setState({condition:t.data})},error:function(e){s.default.fail(e)}})}},{key:"onSearchBarChange",value:function(e,t){this.state.searchValue=e}},{key:"onSubmit",value:function(){this.setState({movieList:[]}),this.reload()}},{key:"onClear",value:function(){this.setState({movieList:[]}),this.state.searchValue="",this.reload()}},{key:"render",value:function(){var e=this,t=this;return _.default.createElement("div",{className:"page"},_.default.createElement(E.default,{initializing:0,hasMore:this.state.hasNextPage,onLoadMore:this.loadMore.bind(this),autoLoadMore:!0,className:"movie_scroll_view"},_.default.createElement(T.Panel,null,_.default.createElement(T.SearchBar,{onChange:this.onSearchBarChange.bind(this),onSubmit:this.onSubmit.bind(this),onClear:this.onClear.bind(this),defaultValue:this.state.searchValue,placeholder:"搜索影片",lang:{cancel:"取消"}})),this.state.condition?_.default.createElement("div",null,_.default.createElement("div",{className:"movie_condiction_cell",style:{marginTop:"6px"}},_.default.createElement("div",{className:-1==this.state.area?"movie_condiction_item selected":"movie_condiction_item",onClick:function(e){t.setState({area:-1}),t.reload()}},"全部"),this.state.condition.areaList.map(function(a,i){return _.default.createElement("div",{className:e.state.area==a?"movie_condiction_item selected":"movie_condiction_item",key:i,"data-index":i,onClick:function(e){var a=e.currentTarget.getAttribute("data-index"),i=t.state.condition.areaList[a];t.setState({area:i}),t.state.area=i,t.reload()}},a)})),_.default.createElement("div",{className:"movie_condiction_cell"},_.default.createElement("div",{className:-1==this.state.moviecatId?"movie_condiction_item selected":"movie_condiction_item",onClick:function(e){t.setState({moviecatId:-1}),t.reload()}},"全部"),this.state.condition.moviecatList.map(function(a,i){return _.default.createElement("div",{className:e.state.moviecatId==a.id?"movie_condiction_item selected":"movie_condiction_item",key:i,"data-index":i,onClick:function(a){var i=a.currentTarget.getAttribute("data-index"),n=e.state.condition.moviecatList[i].id;t.setState({moviecatId:n}),t.state.moviecatId=n,t.reload()}},a.name)})),_.default.createElement("div",{className:"movie_condiction_cell"},_.default.createElement("div",{className:-1==this.state.times?"movie_condiction_item selected":"movie_condiction_item",onClick:function(e){t.setState({times:-1}),t.reload()}},"全部"),this.state.condition.timesList.map(function(a,i){return _.default.createElement("div",{className:e.state.times==a?"movie_condiction_item selected":"movie_condiction_item",key:i,"data-index":i,onClick:function(e){var a=e.currentTarget.getAttribute("data-index"),i=t.state.condition.timesList[a];t.setState({times:i}),t.reload()}},a)}))):null,this.state.movieList.map(function(a,i){return _.default.createElement("div",{key:i,"data-movieid":a.id,onClick:function(a){var i=a.currentTarget.getAttribute("data-movieid"),n="/movieDetail?organId="+e.state.organId+"&stgId="+e.state.stgId+"&organName="+e.state.organName+"&movieId="+i;t.props.history.push(n)}},_.default.createElement("div",{className:"movie_cell"},_.default.createElement("img",{src:a.previewPoster,className:"movie_image",mode:"aspectFill"}),_.default.createElement("div",{style:{width:"60%"}},_.default.createElement("div",{className:"movie_name"},a.name),_.default.createElement("div",{className:"movie_desc"},a.aliasName),_.default.createElement("div",{className:"movie_desc"},"类型: ",a.category),_.default.createElement("div",{className:"movie_desc"},"导演: ",a.directors)),_.default.createElement("div",null,_.default.createElement("div",{className:"movie_book","data-index":i,onClick:function(a){a.stopPropagation();var i=a.currentTarget.getAttribute("data-index"),n=t.state.movieList[i],o=n.name,s=n.prodNation+"/"+n.lang+"/"+n.runTime+"分钟",r="/movieBook?organId="+e.state.organId+"&stgId="+e.state.stgId+"&organName="+e.state.organName+"&movieId="+n.id+"&movieName="+o+"&movieRunTime="+n.runTime+"&movieDesc="+s;t.props.history.push(r)}},"观影"))),_.default.createElement("div",{className:"movie_separator"}))})))}}]),t}(_.default.Component);t.default=M,e.exports=t.default},568:function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),r=a(0),l=function(e){return e&&e.__esModule?e:{default:e}}(r);a(569);var c={init:"",pulling:"pulling",enough:"pulling enough",refreshing:"refreshing",refreshed:"refreshed",reset:"reset",loading:"loading"},d=function(e){function t(){i(this,t);var e=n(this,Object.getPrototypeOf(t).call(this));return e.state={loaderState:c.init,pullHeight:0,progressed:0},e}return o(t,e),s(t,[{key:"setInitialTouch",value:function(e){this._initialTouch={clientY:e.clientY}}},{key:"calculateDistance",value:function(e){return e.clientY-this._initialTouch.clientY}},{key:"easing",value:function(e){var t=e,a=screen.availHeight;return a/2.5*Math.sin(t/a*(Math.PI/2))+0}},{key:"canRefresh",value:function(){return this.props.onRefresh&&[c.refreshing,c.loading].indexOf(this.state.loaderState)<0}},{key:"touchStart",value:function(e){this.canRefresh()&&1==e.touches.length&&(this._initialTouch={clientY:e.touches[0].clientY,scrollTop:this.refs.panel.scrollTop})}},{key:"touchMove",value:function(e){if(this.canRefresh()){var t=this.refs.panel.scrollTop,a=this.calculateDistance(e.touches[0]);if(a>0&&t<=0){var i=a-this._initialTouch.scrollTop;i<0&&(i=0,this._initialTouch.scrollTop=a);var n=this.easing(i);n&&e.preventDefault(),this.setState({loaderState:n>this.props.distanceToRefresh?c.enough:c.pulling,pullHeight:n})}}}},{key:"touchEnd",value:function(){var e=this;if(this.canRefresh()){var t={loaderState:c.reset,pullHeight:0};this.state.loaderState==c.enough?(this.setState({loaderState:c.refreshing,pullHeight:0}),this.props.onRefresh(function(){e.setState({loaderState:c.refreshed,pullHeight:0})},function(){e.setState(t)})):this.setState(t)}}},{key:"loadMore",value:function(){var e=this;this.setState({loaderState:c.loading}),this.props.onLoadMore(function(){e.setState({loaderState:c.init})})}},{key:"onScroll",value:function(e){if(this.props.autoLoadMore&&this.props.hasMore&&this.state.loaderState!=c.loading){var t=e.currentTarget;t.scrollHeight-t.clientHeight-t.scrollTop<5&&this.loadMore()}}},{key:"componentWillReceiveProps",value:function(e){e.initializing<2&&this.setState({progressed:0})}},{key:"animationEnd",value:function(){var e={};this.state.loaderState==c.refreshed&&(e.loaderState=c.init),this.props.initializing>1&&(e.progressed=1),this.setState(e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.className,i=t.hasMore,n=t.initializing,o=this.state,s=o.loaderState,r=o.pullHeight,c=o.progressed,d=i?l.default.createElement("div",{className:"tloader-footer"},l.default.createElement("div",{className:"tloader-btn",onClick:function(t){return e.loadMore(t)}}),l.default.createElement("div",{className:"tloader-loading"},l.default.createElement("i",{className:"ui-loading"}))):null,u=r?{WebkitTransform:"translate3d(0,"+r+"px,0)"}:null,m="";return c||(n>0&&(m+=" tloader-progress"),n>1&&(m+=" ed")),l.default.createElement("div",{ref:"panel",className:"tloader state-"+s+" "+a+m,onScroll:function(t){return e.onScroll(t)},onTouchStart:function(t){return e.touchStart(t)},onTouchMove:function(t){return e.touchMove(t)},onTouchEnd:function(t){return e.touchEnd(t)},onAnimationEnd:function(t){return e.animationEnd(t)}},l.default.createElement("div",{className:"tloader-symbol"},l.default.createElement("div",{className:"tloader-msg"},l.default.createElement("i",null)),l.default.createElement("div",{className:"tloader-loading"},l.default.createElement("i",{className:"ui-loading"}))),l.default.createElement("div",{className:"tloader-body",style:u},this.props.children),d)}}]),t}(l.default.Component);d.defaultProps={distanceToRefresh:60,autoLoadMore:1},t.default=d},569:function(e,t){},570:function(e,t){}});